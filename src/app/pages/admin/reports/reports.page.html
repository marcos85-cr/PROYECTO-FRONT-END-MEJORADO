<ion-header class="ion-no-border">
    <ion-toolbar color="primary">
        <ion-buttons slot="start">
            <ion-back-button defaultHref="/admin/dashboard"></ion-back-button>
        </ion-buttons>
        <ion-title>Reportes y Auditoría</ion-title>
    </ion-toolbar>
</ion-header>

<ion-content color="secondary">
    <div class="reports-container">

        <ion-card>
            <ion-card-header>
                <ion-card-title>Período de Reporte</ion-card-title>
                <ion-card-subtitle>
                    Reportes desde: <strong>{{ reportData.periodoInicio }}</strong>
                    hasta: <strong>{{ reportData.periodoFin }}</strong>
                </ion-card-subtitle>
            </ion-card-header>
            <ion-card-content>
                <ion-item lines="none">
                    <ion-label position="stacked">Fecha Inicio</ion-label>
                    <ion-datetime [(ngModel)]="startDate" displayFormat="YYYY-MM-DD"
                        (ionChange)="loadReports()"></ion-datetime>
                </ion-item>
                <ion-item lines="none">
                    <ion-label position="stacked">Fecha Fin</ion-label>
                    <ion-datetime [(ngModel)]="endDate" displayFormat="YYYY-MM-DD" (ionChange)="loadReports()"></ion-datetime>
                </ion-item>
            </ion-card-content>
        </ion-card>

        <ion-card>
            <ion-card-header>
                <ion-card-title>Resumen de Operaciones</ion-card-title>
                <ion-card-subtitle>Datos del período {{ reportData.periodoInicio }} - {{ reportData.periodoFin }}</ion-card-subtitle>
            </ion-card-header>
            <ion-card-content>
                <ion-grid>
                    <ion-row>
                        <ion-col size="6">
                            <div class="summary-box">
                                <ion-icon name="swap-horizontal" color="primary"></ion-icon>
                                <h3>{{ reportData.totalTransactions | number }}</h3>
                                <p>Transacciones</p>
                            </div>
                        </ion-col>
                        <ion-col size="6">
                            <div class="summary-box">
                                <ion-icon name="cash" color="success"></ion-icon>
                                <h3>{{ reportData.totalVolume | currency:'USD':'symbol':'1.0-0' }}</h3>
                                <p>Volumen Total</p>
                            </div>
                        </ion-col>
                    </ion-row>
                </ion-grid>
            </ion-card-content>
        </ion-card>

        <ion-card>
            <ion-card-header>
                <ion-card-title>Top Clientes</ion-card-title>
                <ion-card-subtitle>Clientes por volumen de operación</ion-card-subtitle>
            </ion-card-header>
            <ion-card-content>
                <ion-list>
                    <ion-item *ngFor="let client of reportData.topClients" lines="full">
                        <ion-label>
                            <h3>{{ client.nombre }}</h3>
                            <p>Volumen: {{ client.volumen | currency:'USD':'symbol':'1.0-0' }}</p>
                            <p>Transacciones: {{ client.transacciones }}</p>
                        </ion-label>
                    </ion-item>
                </ion-list>
            </ion-card-content>
        </ion-card>

        <ion-card>
            <ion-card-header>
                <ion-card-title>Volumen Diario</ion-card-title>
                <ion-card-subtitle>Distribución en el período</ion-card-subtitle>
            </ion-card-header>
            <ion-card-content>
                <div class="chart-placeholder">
                    [GRÁFICO DE VOLUMEN AQUÍ]
                    <p class="placeholder-text">Datos: {{ reportData.dailyVolume.length }} días de registro.</p>
                </div>
            </ion-card-content>
        </ion-card>

        <ion-card>
            <ion-card-header>
                <ion-card-title>Registro de Auditoría</ion-card-title>
                <ion-card-subtitle>Últimas 20 acciones</ion-card-subtitle>
            </ion-card-header>
            <ion-card-content>
                <ion-list>
                    <ion-item *ngFor="let log of auditLogs" lines="full">
                        <ion-icon slot="start" [name]="getAuditIcon(log.accion)"
                            [color]="getAuditColor(log.accion)"></ion-icon>
                        <ion-label>
                            <h3>{{ log.accion }}</h3>
                            <p>{{ log.usuario }} - {{ log.descripcion }}</p>
                            <p class="timestamp">{{ log.fecha | date:'short' }}</p>
                        </ion-label>
                    </ion-item>
                </ion-list>
            </ion-card-content>
        </ion-card>

        <div class="download-buttons">
            <ion-button expand="block" color="danger" (click)="downloadPDF()">
                <ion-icon slot="start" name="document-text"></ion-icon>
                Descargar PDF
            </ion-button>
            <ion-button expand="block" color="success" (click)="downloadExcel()">
                <ion-icon slot="start" name="document"></ion-icon>
                Descargar Excel
            </ion-button>
        </div>

    </div>
</ion-content>