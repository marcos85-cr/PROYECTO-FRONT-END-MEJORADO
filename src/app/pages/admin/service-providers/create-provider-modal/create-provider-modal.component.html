<ion-header>
    <ion-toolbar color="primary">
        <ion-title>{{ isEdit ? 'Editar' : 'Nuevo' }} Proveedor</ion-title>
        <ion-buttons slot="end">
            <ion-button (click)="dismiss()">
                <ion-icon name="close" slot="icon-only"></ion-icon>
            </ion-button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
    <form [formGroup]="providerForm">

        <!-- Información Básica -->
        <ion-card>
            <ion-card-header>
                <ion-card-title color="primary">Información Básica</ion-card-title>
            </ion-card-header>
            <ion-card-content>

                <ion-item>
                    <ion-label position="stacked">Nombre del Proveedor *</ion-label>
                    <ion-input formControlName="nombre" placeholder="Ej: AyA, ICE, Kölbi">
                    </ion-input>
                </ion-item>
                <ion-text color="danger"
                    *ngIf="providerForm.get('nombre')?.invalid && providerForm.get('nombre')?.touched">
                    <small>El nombre es requerido (mínimo 3 caracteres)</small>
                </ion-text>

                <ion-item>
                    <ion-label position="stacked">Código de Empresa *</ion-label>
                    <ion-input formControlName="codigoEmpresa" placeholder="Ej: AYA001">
                    </ion-input>
                </ion-item>
                <ion-text color="danger"
                    *ngIf="providerForm.get('codigoEmpresa')?.invalid && providerForm.get('codigoEmpresa')?.touched">
                    <small>El código es requerido (mínimo 3 caracteres)</small>
                </ion-text>

                <ion-item>
                    <ion-label position="stacked">Tipo de Servicio *</ion-label>
                    <ion-select formControlName="tipo" placeholder="Seleccione un tipo">
                        <ion-select-option value="Agua">Agua</ion-select-option>
                        <ion-select-option value="Electricidad">Electricidad</ion-select-option>
                        <ion-select-option value="Telefonía">Telefonía</ion-select-option>
                        <ion-select-option value="Municipalidades">Municipalidades</ion-select-option>
                        <ion-select-option value="Cobro Judicial">Cobro Judicial</ion-select-option>
                    </ion-select>
                </ion-item>

                <ion-item>
                    <ion-label position="stacked">Icono</ion-label>
                    <ion-select formControlName="icon" placeholder="Seleccione un icono">
                        <ion-select-option value="water">Agua</ion-select-option>
                        <ion-select-option value="flash">Electricidad</ion-select-option>
                        <ion-select-option value="call">Teléfono</ion-select-option>
                        <ion-select-option value="business">Edificio</ion-select-option>
                        <ion-select-option value="document-text">Documento</ion-select-option>
                        <ion-select-option value="card">Tarjeta</ion-select-option>
                    </ion-select>
                </ion-item>

                <ion-item>
                    <ion-label position="stacked">Descripción</ion-label>
                    <ion-textarea formControlName="descripcion" placeholder="Descripción breve del proveedor" rows="2">
                    </ion-textarea>
                </ion-item>

            </ion-card-content>
        </ion-card>

        <!-- Reglas de Validación -->
        <ion-card>
            <ion-card-header>
                <ion-card-title color="primary">
                    <ion-icon name="shield-checkmark" slot="start"></ion-icon>
                    Reglas de Validación del Número de Contrato
                </ion-card-title>
            </ion-card-header>
            <ion-card-content>

                <ion-item>
                    <ion-label>Tipo de Validación</ion-label>
                    <ion-select [(ngModel)]="validationType" (ionChange)="onValidationTypeChange()"
                        [ngModelOptions]="{standalone: true}">
                        <ion-select-option value="range">Rango de Longitud</ion-select-option>
                        <ion-select-option value="exact">Longitud Exacta</ion-select-option>
                    </ion-select>
                </ion-item>

                <!-- Longitud Exacta -->
                <ion-item *ngIf="validationType === 'exact'">
                    <ion-label position="stacked">Longitud Exacta *</ion-label>
                    <ion-input formControlName="exactLength" type="number" min="1" placeholder="Ej: 8">
                    </ion-input>
                </ion-item>

                <!-- Rango de Longitud -->
                <div *ngIf="validationType === 'range'">
                    <ion-item>
                        <ion-label position="stacked">Longitud Mínima *</ion-label>
                        <ion-input formControlName="minLength" type="number" min="1" placeholder="Ej: 8">
                        </ion-input>
                    </ion-item>

                    <ion-item>
                        <ion-label position="stacked">Longitud Máxima *</ion-label>
                        <ion-input formControlName="maxLength" type="number" min="1" placeholder="Ej: 12">
                        </ion-input>
                    </ion-item>
                </div>

                <ion-item>
                    <ion-label>Permitir Solo Números</ion-label>
                    <ion-toggle formControlName="onlyNumbers"></ion-toggle>
                </ion-item>

                <ion-item>
                    <ion-label position="stacked">Mensaje Personalizado</ion-label>
                    <ion-textarea formControlName="customMessage"
                        placeholder="Mensaje que verá el usuario si el formato es incorrecto" rows="2">
                    </ion-textarea>
                </ion-item>

                <!-- Preview de Validación -->
                <div class="validation-preview">
                    <h4>Vista Previa:</h4>
                    <p>{{ getValidationPreview() }}</p>
                </div>

            </ion-card-content>
        </ion-card>

        <!-- Botones -->
        <div class="form-actions">
            <ion-button expand="block" color="medium" fill="outline" (click)="dismiss()">
                Cancelar
            </ion-button>
            <ion-button expand="block" color="primary" (click)="saveProvider()" [disabled]="!isFormValid()">
                {{ isEdit ? 'Actualizar' : 'Crear' }} Proveedor
            </ion-button>
        </div>

    </form>
</ion-content>