
<ion-header class="ion-no-border">
    <ion-toolbar color="primary">
        <ion-buttons slot="start">
            <ion-back-button defaultHref="/login" text=""></ion-back-button>
        </ion-buttons>
        <ion-title>Crear Cuenta</ion-title>
    </ion-toolbar>
    <div class="header-section">
        <ion-avatar class="logo-avatar">
            <img src="assets/icon/BANK.jpg" alt="Bank Logo" />
        </ion-avatar>
    </div>
    
</ion-header>

<ion-content class="ion-padding" color="primary">
    <div class="register-container">

        <div class="header-section">
            <h2>Registro de Usuario</h2>
            <p>Complete los siguientes datos</p>
        </div>

        <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">

            <!-- Nombre Completo -->
            <ion-item lines="none" class="input-item" color="white">
                <ion-icon name="person-outline" slot="start" color="primary"></ion-icon>
                <ion-input type="text" formControlName="nombre" placeholder="Nombre completo"
                    [clearInput]="true" ></ion-input>
            </ion-item>
            <div class="error-message"
                *ngIf="registerForm.get('nombre')?.invalid && registerForm.get('nombre')?.touched">
                <ion-text >
                    <small>El nombre es requerido</small>
                </ion-text>
            </div>

            <!-- Identificación -->
            <ion-item lines="none" class="input-item" color="white">
                <ion-icon name="card-outline" slot="start" color="primary"></ion-icon>
                <ion-input type="text" formControlName="identificacion" placeholder="Identificación"
                    [clearInput]="true"></ion-input>
            </ion-item>
            <div class="error-message"
                *ngIf="registerForm.get('identificacion')?.invalid && registerForm.get('identificacion')?.touched">
                <ion-text >
                    <small>La identificación es requerida</small>
                </ion-text>
            </div>

            <!-- Teléfono -->
            <ion-item lines="none" class="input-item" color="white">
                <ion-icon name="call-outline" slot="start" color="primary"></ion-icon>
                <ion-input type="tel" formControlName="telefono" placeholder="Teléfono" [clearInput]="true"></ion-input>
            </ion-item>
            <div class="error-message"
                *ngIf="registerForm.get('telefono')?.invalid && registerForm.get('telefono')?.touched">
                <ion-text >
                    <small>El teléfono es requerido</small>
                </ion-text>
            </div>

            <!-- Email -->
            <ion-item lines="none" class="input-item" color="white">
                <ion-icon name="mail-outline" slot="start" color="primary"></ion-icon>
                <ion-input type="email" formControlName="email" placeholder="Correo electrónico"
                    [clearInput]="true"></ion-input>
            </ion-item>
            <div class="error-message" *ngIf="registerForm.get('email')?.invalid && registerForm.get('email')?.touched">
                <ion-text >
                    <small>Ingrese un correo válido</small>
                </ion-text>
            </div>

            <!-- Password -->
            <ion-item lines="none" class="input-item" color="white">
                <ion-icon name="lock-closed-outline" slot="start" color="primary"></ion-icon>
                <ion-input [type]="showPassword ? 'text' : 'password'" formControlName="password"
                    placeholder="Contraseña"></ion-input>
                <ion-icon slot="end" [name]="showPassword ? 'eye-off-outline' : 'eye-outline'"
                    (click)="togglePassword()" color="medium"></ion-icon>
            </ion-item>
            <div class="password-requirements">
                <ion-text color="light">
                    <small>Mínimo 8 caracteres, 1 mayúscula, 1 número y 1 símbolo</small>
                </ion-text>
            </div>
            <div class="error-message"
                *ngIf="registerForm.get('password')?.invalid && registerForm.get('password')?.touched">
                <ion-text >
                    <small>La contraseña no cumple los requisitos</small>
                </ion-text>
            </div>

            <!-- Confirm Password -->
            <ion-item lines="none" class="input-item" color="white">
                <ion-icon name="lock-closed-outline" slot="start" color="primary"></ion-icon>
                <ion-input [type]="showConfirmPassword ? 'text' : 'password'" formControlName="confirmPassword"
                    placeholder="Confirmar contraseña"></ion-input>
                <ion-icon slot="end" [name]="showConfirmPassword ? 'eye-off-outline' : 'eye-outline'"
                    (click)="toggleConfirmPassword()" color="medium"></ion-icon>
            </ion-item>
            <div class="error-message"
                *ngIf="registerForm.hasError('passwordMismatch') && registerForm.get('confirmPassword')?.touched">
                <ion-text >
                    <small>Las contraseñas no coinciden</small>
                </ion-text>
            </div>

            <!-- Role Selection (solo para Admin) -->
            <ion-item lines="none" class="input-item" *ngIf="canSelectRole">
                <ion-icon name="people-outline" slot="start" color="primary"></ion-icon>
                <ion-select formControlName="role" placeholder="Seleccione rol">
                    <ion-select-option value="Cliente">Cliente</ion-select-option>
                    <ion-select-option value="Gestor">Gestor</ion-select-option>
                    <ion-select-option value="Administrador">Administrador</ion-select-option>
                </ion-select>
            </ion-item>

            <!-- Register Button -->
            <ion-button expand="block" type="submit" class="register-button" color=""
                [disabled]="registerForm.invalid || isLoading">
                <ion-spinner name="crescent" *ngIf="isLoading"></ion-spinner>
                <span *ngIf="!isLoading">Crear Cuenta</span>
            </ion-button>

            <!-- Login Link -->
            <div class="login-link">
                <ion-text color="light">
                    ¿Ya tiene una cuenta?
                </ion-text>
                <ion-text color="secondary" routerLink="/login">
                    <strong> Inicie sesión</strong>
                </ion-text>
            </div>
        </form>
    </div>
</ion-content>